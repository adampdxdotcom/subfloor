project_notes.txt

Hello!  We are working on a project.  Here is file tree as well as a synopsis of what we've done so far.  Familiarize yourself and then I will tell you the goal. 

Do not make any code unless asked.
Do not make adjustments that were not requested. If there is an issue applying a change, let's talk about it.
Provide only diff files, not fully modified files.
Please don't make code for files you haven't seen.

>>>
.
|____.dockerignore
|____.env
|____.env.example
|____.github
   |____workflows
      |____publish.yml
|____.gitignore
|____App.tsx
|____Dockerfile
|____Dockerfile.dev
|____LICENSE
|____README.md
|____androidPlan.txt
|____assets
|____capacitor.config.ts
|____components
|____context
   |____BiometricContext.tsx
   |____DataContext.tsx
|____data
   |____changelog.ts
|____docker-compose.dev.yml
|____docker-compose.yml
|____hooks
   |____useChangeOrderMutations.ts
   |____useChangeOrders.ts
   |____useCurrentUser.ts
   |____useCustomers.ts
   |____useHistory.ts
   |____useInstallerMutations.ts
   |____useInstallers.ts
   |____useJobs.ts
   |____useMaterialOrderMutations.ts
   |____useMaterialOrders.ts
   |____useMedia.ts
   |____useNotifications.ts
   |____usePhotos.ts
   |____useProducts.ts
   |____useProjects.ts
   |____useQuoteMutations.ts
   |____useQuotes.ts
   |____useSampleCheckoutMutations.ts
   |____useSampleCheckouts.ts
   |____useUsers.ts
   |____useVendorMutations.ts
   |____useVendors.ts
   |____useWindowSize.ts
|____index.css
|____index.html
|____index.tsx
|____metadata.json
|____migrations
   |____1765151641142_init-schema.cjs
   |____1765151641815_transform_messages_to_conversations.cjs
   |____1765151700000_add_mute_to_participants.cjs
   |____1765225000000_add_urls_to_vendors.cjs
   |____1765230000000_add_lvp_fields.cjs
   |____1765235000000_add_interest_variant.cjs
   |____1765241000000_backfill_missing_jobs.cjs
   |____1765251800000_calendar_and_notifications_schema_update.cjs
   |____1765352200000_installer_types.cjs
   |____1765363000000_link_appointments_to_quotes.cjs
   |____1765474000000_update_sample_checkouts_targets.cjs
   |____1765560000000_add_calendar_token.cjs
   |____1765570000000_add_pinned_to_job_notes.cjs
   |____1765580000000_add_email_templates.cjs
   |____1765590000000_add_mobile_settings.cjs
   |____1765600000000_add_user_devices.cjs
   |____1765700000000_add_size_aliases.cjs
   |____1765710000000_create_media_assets_table.cjs
   |____1765720000000_add_unique_constraint_to_media_assets.cjs
   |____1765800000000_add_product_aliases.cjs
|____node_modules
|____package-lock.json
|____package.json
|____pages
   |____CalendarView.tsx
   |____CustomerDetail.tsx
   |____CustomerList.tsx
   |____Dashboard.tsx
   |____ImportData.tsx
   |____InstallerDetail.tsx
   |____InstallerList.tsx
   |____KnowledgeBase.tsx
   |____Messages.tsx
   |____OrderDashboard.tsx
   |____ProjectDetail.tsx
   |____QuoteDetail.tsx
   |____Reports.tsx
   |____SampleLibrary.tsx
   |____ServerConnect.tsx
   |____Settings.tsx
   |____SetupWizard.tsx
   |____VendorDetail.tsx
   |____VendorList.tsx
|____postcss.config.js
|____project.txt
|____project_1old.txt
|____project_notes.txt
|____schema.sql
|____server
   |____db.js
   |____email-templates
      |____customerReminder.html
      |____orderDamage.html
      |____orderReceived.html
      |____pastDueReminder.html
      |____upcomingJobCustomer.html
      |____upcomingJobLead.html
      |____userInvite.html
   |____index.js
   |____lib
      |____dbInit.js
      |____emailService.js
      |____imageProcessor.js
      |____reportGenerator.js
      |____reports.js
      |____scheduler.js
      |____setupService.js
   |____make-admin.js
   |____migrate-images.js
   |____migrate-media-assets.js
   |____migrate-profiles.js
   |____node_modules
   |____package-lock.json
   |____package.json
   |____public
      |____assets
      |____index.html
   |____routes
      |____backup.js
      |____calendar.js
      |____calendarFeed.js
      |____change-orders.js
      |____customers.js
      |____email-templates.js
      |____events.js
      |____import.js
      |____installers.js
      |____jobNotes.js
      |____jobs.js
      |____kb.js
      |____media.js
      |____messages.js
      |____notifications.js
      |____orders.js
      |____photos.js
      |____preferences.js
      |____products.js
      |____projects.js
      |____quotes.js
      |____reminders.js
      |____reportGenerator.js
      |____reports.js
      |____restore.js
      |____roles.js
      |____sampleCheckouts.js
      |____search.js
      |____setup.js
      |____system.js
      |____users.js
      |____vendors.js
   |____schema.sql
   |____temp-uploads
   |____uploads
      |____.gitkeep
      |____avatars
         |____.gitkeep
      |____branding
         |____.gitkeep
      |____jobs
         |____.gitkeep
         |____originals
         |____thumbnails
      |____products
         |____.gitkeep
         |____originals
         |____thumbnails
   |____utils.js
|____services
   |____changeOrderService.ts
   |____customerService.ts
   |____emailTemplateService.ts
   |____eventService.ts
   |____installerService.ts
   |____jobNotesService.ts
   |____jobService.ts
   |____materialOrderService.ts
   |____mediaService.ts
   |____notificationService.ts
   |____preferenceService.ts
   |____productService.ts
   |____projectService.ts
   |____quoteService.ts
   |____reportService.ts
   |____sampleCheckoutService.ts
   |____sampleService.ts
   |____spreadsheetService.ts
   |____userService.ts
   |____vendorService.ts
|____tailwind.config.js
|____temp-uploads
|____todo.txt
|____tree.sh
|____tree.txt
|____tree_content.tmp
|____tsconfig.json
|____types.ts
|____userauditplan.txt
|____utils
   |____apiConfig.ts
   |____changeFormatter.ts
   |____cryptoUtils.ts
   |____csvUtils.ts
   |____dateUtils.ts
   |____pricingUtils.ts
|____vite.config.ts
>>>


Project Overview

Subfloor is a full-stack management platform for contracting businesses (specifically flooring). It handles the entire lifecycle of a job: CRM, Project Tracking, Inventory/Sample Management, Scheduling, Financials, and Supply Chain Logistics.
Landmark 1: Architectural Foundation & CRUD (Sessions 3–5)

    Full-Stack Refactor: Migrated to a clean Router-based backend and a dedicated Service Layer on the frontend.

    Core CRUD: Established robust patterns for managing Customers, Projects, Installers, and Samples.

    Vendor System: Built a relational Vendor management system to handle Manufacturers and Suppliers independently.

Landmark 2: Security, Identity & RBAC (Sessions 6–7)

    Authentication: Integrated SuperTokens for multi-user security.

    Role-Based Access Control (RBAC): Built a system of Admins and Users with granular permissions and a dedicated User Management UI.

    Auditing: Implemented a system-wide Activity Log that tracks and formats human-readable data changes.

Landmark 3: Advanced Business Logic & Automation (Sessions 8–15)

    Scheduling Overhaul: Moved from static dates to a flexible "Multi-Appointment" model with a collaborative Team Calendar.

    Pricing Engine: Built a hierarchical engine supporting Markup vs. Margin, Vendor overrides, and "Cost-to-Retail" waterfall calculations.

    Email Engine: Developed a backend automation system for customer reminders and internal daily summaries using dynamic templates.

    Branding & Theming: Created a white-label engine allowing admins to upload logos and define "Semantic" theme colors.

Landmark 4: Production Hardening & Scalability (Sessions 16–21)

    Deployment: Shifted from loose Dev containers to a hardened "Monolith" Production Docker build.

    React Query Migration: Replaced the monolithic DataContext with TanStack Query for isolated data fetching and instant UI updates.

    Zero-Config Setup: Created a "Setup Wizard" for self-initializing fresh instances and hardened the Backup/Restore system.

Landmark 5: Ecosystem Expansion (Sessions 24–35)

    Knowledge Base (Wiki): Built a mobile-first CMS with polymorphic media storage and internal "Mention" linking.

    Supply Chain Logic: Modeled Manufacturer-to-Distributor relationships and automated ETA calculations.

    Mobile Native Transformation: Wrapped the application into a native Android app via Capacitor, adding hardware-aware features like Flashlight-assisted QR scanning.

    Connectivity: Built an iCal Subscription Engine to sync Subfloor schedules with external Google/Apple calendars.

Landmark 6: UI Modernization & The "Workbench" (Sessions 37–42)

    Material Design 3 Reskin: Overhauled the entire UI using a modern, "de-boxed" M3 aesthetic with fluid layouts and high-contrast logic.

    The Media Library: Centralized all project, product, and KB assets into a single management interface.

    The Intelligent Import Engine: Built a sophisticated "Data Workbench" for cleaning messy vendor spreadsheets.

        Landmark Feature: Added "Alias Memory" (Learning Engine) and a "Pricing Audit" mode that automatically identifies and corrects outdated prices during import.
