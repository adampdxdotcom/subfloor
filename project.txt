================================================================================
                            PROJECT SUMMARY: Joblogger
================================================================================


--- PROJECT FILE STRUCTURE ---

.
|-- .dockerignore
|-- .env
|-- .gitignore
|-- App.tsx
|-- Dockerfile
|-- Dockerfile.server
|-- README.md
|-- index.css
|-- index.html
|-- index.tsx
|-- package-lock.json
|-- package.json
|-- postcss.config.js
|-- schema.sql
|-- tailwind.config.js
|-- tsconfig.json
|-- types.ts
|-- vite.config.ts
|
|-- components/
|   |-- AddEditVendorModal.tsx
|   |-- AddSampleInlineModal.tsx
|   |-- ChangeOrderSection.tsx
|   |-- CollapsibleSection.tsx
|   |-- CustomerSelector.tsx
|   |-- EditChangeOrderModal.tsx
|   |-- EditCustomerModal.tsx
|   |-- EditInstallerModal.tsx
|   |-- EditProjectModal.tsx
|   |-- FinalizeJobSection.tsx
|   |-- Layout.tsx
|   |-- MaterialOrdersSection.tsx
|   |-- PrintableCheckout.tsx
|   |-- ProjectInfoHeader.tsx
|   |-- ProjectSelector.tsx
|   |-- QrScanner.tsx
|   |-- QuickCheckoutModal.tsx
|   |-- QuotesSection.tsx
|   |-- RestoreForm.tsx
|   |-- SampleCheckoutsSection.tsx
|   |-- SampleDetailModal.tsx
|   |-- SampleSelector.tsx
|   |-- UniversalSearch.tsx
|   |-- UserStatus.tsx
|
|-- context/
|   |-- DataContext.tsx
|
|-- pages/
|   |-- CalendarView.tsx
|   |-- CustomerDetail.tsx
|   |-- CustomerList.tsx
|   |-- Dashboard.tsx
|   |-- InstallerDetail.tsx
|   |-- InstallerList.tsx
|   |-- ProjectDetail.tsx
|   |-- QuoteDetail.tsx
|   |-- SampleLibrary.tsx
|   |-- Settings.tsx
|   |-- VendorList.tsx
|
|-- server/
|   |-- db.js
|   |-- index.js
|   |-- package.json
|   |-- utils.js
|   |-- routes/
|   |   |-- backup.js
|   |   |-- calendar.js
|   |   |-- change-orders.js
|   |   |-- customers.js
|   |   |-- installers.js
|   |   |-- jobs.js
|   |   |-- (...and 10 more routes)
|   |-- temp-uploads/
|   |-- uploads/
|       |-- photo-1762749727265-184370968.jpeg
|       |-- photo-1762785251830-612632601.jpeg
|       |-- (...and more images)
|
|-- services/
|   |-- changeOrderService.ts
|   |-- customerService.ts
|   |-- installerService.ts
|   |-- jobService.ts
|   |-- materialOrderService.ts
|   |-- projectService.ts
|   |-- quoteService.ts
|   |-- sampleCheckoutService.ts
|   |-- sampleService.ts
|   |-- userService.ts
|   |-- vendorService.ts
|
|-- utils/
    |-- cryptoUtils.ts


--- PROJECT OVERVIEW ---

Joblogger is a full-stack web application designed to be a comprehensive management tool for small contracting businesses, such as flooring installers. It provides a single, centralized platform to track the entire lifecycle of a job, from initial customer inquiry to final completion.

The application is built to handle the complex, real-world workflows of a contracting business. Key functionalities include:

  * Customer Relationship Management (CRM): Create, view, and edit a complete list of customers.
  * Project Tracking: Manage individual jobs for each customer, each with its own intelligent status (e.g., New, Quoting, Scheduled, Completed) that updates automatically based on user actions.
  * Sample & Inventory Management: Maintain a central "Sample Library" of materials, and manage a robust multi-step checkout/return process for samples on a per-project basis.
  * Installer & Schedule Management: Manage a list of installers, assign them to jobs via quotes, and view their schedules on a color-coded, interactive calendar to prevent conflicts.
  * Financials: Create, edit, and manage quotes with detailed cost breakdowns. Track change orders, calculate required deposits, and view the final balance due for each job.
  * Material Ordering: Place and track material orders for scheduled jobs.

The entire application is built on a modern, robust technology stack, including a React (TypeScript) frontend, a Node.js (Express) backend API, and a persistent PostgreSQL database. The full stack is containerized with Docker for a stable, portable, and easily reproducible development and deployment environment.


================================================================================
                            DEVELOPMENT HISTORY
================================================================================


--- SESSION 3: Architectural Overhaul & Core Feature Implementation ---
This was a massive session focused on architectural improvements, completing core functionality, and adding major new features.

1. FULL-STACK ARCHITECTURAL OVERHAUL (MAJOR IMPROVEMENT)
    * Backend Refactor: Migrated the entire backend to a clean, router-based architecture in `server/routes/`.
    * Frontend Refactor: Created a dedicated Service Layer (`src/services/`) to separate API logic from state management.
    * Docker Architecture: Corrected `docker-compose.yml` to use a proper multi-service architecture, solving critical networking issues.

2. COMPREHENSIVE "DELETE" FUNCTIONALITY (CORE CRUD COMPLETE)
    * Pattern Established: Built a reusable, safe deletion pattern.
    * Full Implementation: Implemented full-stack delete for Samples, Customers, Projects, and Installers.
    * Advanced Logic: Added business rule enforcement (e.g., preventing deletion of a customer with active projects).

3. "QUICK CHECKOUT" & QR CODE SYSTEM (NEW MAJOR FEATURE)
    * UI/UX: Built a new "Quick Checkout" modal for a fast workflow.
    * Component Architecture: Created reusable `CustomerSelector`, `ProjectSelector`, and `SampleSelector` components.
    * Backend QR Generation: Built a `GET /api/samples/:id/qr` endpoint to generate QR codes for samples.
    * Live QR Scanning: Integrated a camera-based QR code scanner into the checkout flow.

4. FLEXIBLE BUSINESS LOGIC: "INSTALLATION TYPES"
    * Architecture: Implemented "Installation Type" (Managed, Materials Only, etc.) on quotes.
    * Dynamic UI: The Add/Edit Quote modal now intelligently hides irrelevant fields based on the selected type.
    * Decoupled Workflow: Decoupled material ordering from project scheduling for "Materials Only" sales.

5. FULL MOBILE RESPONSIVENESS
    * Main Layout: Refactored `Layout.tsx` to be mobile-first with a collapsible "hamburger" menu.
    * Pages & Grids: Updated all major pages to be responsive and usable on a phone screen.

6. CRITICAL BUG SMASHING & STABILITY
    * Mixed Content: Fixed a persistent "Mixed Content" error by cleaning bad image data.
    * Docker & Networking: Solved multiple `docker-compose` and internal networking errors.
    * Scanner Stability: Fixed a critical bug causing the mobile QR scanner to freeze on a successful scan.

Roadmap (Post-Session 3)
*   Editing: No way to edit a Material Order.
*   Deleting: No way to delete a Material Order.
*   File Uploads: Apply existing system to "Signed Paperwork".
*   "On-the-Fly" Sample Creation: Add during "Quick Checkout" flow.
*   Authentication & Users: The app remains a single-user system.

--------------------------------------------------------------------------------

--- SESSION 4: Backup/Restore System & Docker Hardening ---
This session focused on adding a critical new administrative feature, enhancing existing workflows, and hardening the application's core architecture.

1. FULL-STACK BACKUP & RESTORE SYSTEM (NEW MAJOR FEATURE)
    * New "Settings" Page: Created a dedicated page at `/settings` for administrative functions.
    * Robust Backup: Built backend endpoints (`/api/backup/database`, `/api/backup/images`) that use `pg_dump` to generate reliable ZIP archives.
    * Disaster-Proof Restore: Built backend endpoints to handle uploads for restoring data. Implemented an "atomic swap" strategy for images to avoid file-locking errors.

2. ARCHITECTURAL & DOCKER HARDENING (MAJOR STABILITY IMPROVEMENT)
    * Dedicated Server Dockerfile: Created `Dockerfile.server` to install necessary tools without bloating the frontend image.
    * Eliminated Volume Conflicts: Reconfigured `docker-compose.yml` to use surgical volume mounts for the frontend, preventing Vite's file watcher from locking server files and causing `EBUSY` errors.

3. "EXTEND CHECKOUT" FUNCTIONALITY (NEW FEATURE)
    * Full Stack Implementation: Created a `PATCH` endpoint, service function, and `DataContext` function to allow users to extend a sample's due date by two days.
    * UI Integration: Added a working "Extend" button to the Job Detail page, Sample Detail modal, and Sample Library card view.

4. CRITICAL BUG FIXES & WORKFLOW ENHANCEMENTS
    * Fixed a "Return" button race condition.
    * Fixed the `SampleDetailModal` from closing immediately after returning a sample.

Features We Talked About But Didn't Implement
*   Graceful "Empty State" Handling for when the database is empty.
*   Automatic Pre-Restore Snapshot safety feature.
*   Automated, Scheduled Backups.

--------------------------------------------------------------------------------

--- SESSION 5: Vendor Management System ---
This was a major architectural session focused on building a complete "Vendor Management" system from the ground up and integrating it deeply into core workflows.

1. FULL-STACK VENDOR MANAGEMENT SYSTEM (NEW MAJOR FEATURE)
    * Database: Created a new `vendors` table and refactored the `samples` and `material_orders` tables to use foreign key relationships (`manufacturer_id`, `supplier_id`) instead of free-text fields.
    * Backend API: Built a complete set of RESTful CRUD endpoints for `/api/vendors`.
    * Frontend UI: Created a new "Vendor Directory" page and a reusable "Add/Edit Vendor" modal.

2. DEEP INTEGRATION & WORKFLOW AUTOMATION (MAJOR REFACTOR)
    * "On-the-Fly" Creation: Replaced all manufacturer/supplier text inputs with a consistent, searchable component that allows creating new vendors without leaving the current workflow.
    * Intelligent Autofill & ETA Calculation: The Material Order modal now autofills the supplier and intelligently calculates the material ETA based on the supplier's delivery schedule.

3. CRITICAL BUG SMASHING & REGRESSION FIXES
    * Fixed broken API routes by forcing Docker server rebuilds.
    * Solved database schema mismatch errors by resetting the Docker volume.
    * Fixed modal stacking order (z-index) issues.
    * Fixed a major regression where selecting a manufacturer in the "Add/Edit Sample" modals was failing to save.

--------------------------------------------------------------------------------

--- SESSION 6: Authentication ---
*   A user login system was instituted using Supertokens, transitioning the application from a single-user tool to a multi-user-ready platform.

--------------------------------------------------------------------------------

--- SESSION 7: Full-Stack Stabilization & Critical Workflow Fixes ---
This foundational session focused on identifying and permanently fixing deep-seated issues in the development environment and application state management.

1. FULL-STACK INFRASTRUCTURE STABILIZATION (SOLVED THE RELOAD LOOP)
    * The Problem: The application was caught in a constant page reload loop, making development impossible.
    * The Investigation: Through extensive diagnostic tests, we proved the Docker containers were stable and the reload was triggered by the client-side Vite script due to an unstable WebSocket connection.
    * The Root Cause & Fix: The final root cause was identified as an HTTP protocol mismatch between the Caddy reverse proxy and the Vite dev server. A third party provided a corrected Caddyfile using the `versions h2 h1.1` directive, which stabilized the WebSocket handshake and permanently fixed the reload loop.

2. QUOTE ACCEPTANCE & JOB FINALIZATION WORKFLOW (FULL-STACK BUG FIX)
    * The Problem: Accepting a quote did not correctly transition the project's state, preventing the "Job Details" section from appearing.
    * The Root Cause (Stale State): We diagnosed that the frontend state was inconsistent; the code was updating the local state for the quote, but failing to update the parent project's state.
    * The Full-Stack Solution: We created a new, dedicated workflow (`acceptQuote`) across the entire stack (backend API, service layer, and state management) to ensure both the quote and project are updated transactionally, keeping the UI perfectly in sync with the database. We also fixed a stubborn Vite caching issue by using `docker-compose down -v`.

3. JOB DETAILS & SCHEDULING FORM (UI & API BUG FIXES)
    * The Problem: The "Save Job Details" button was not working correctly, the date fields were not populating, and saving a job with blank dates was crashing the backend API.
    * The Fix: We made the backend `POST /api/jobs` endpoint more robust by sanitizing incoming data (converting empty date strings to NULL). We then fixed the state initialization logic in the `FinalizeJobSection.tsx` component to ensure the form correctly populates with existing job data.

4. UNIFYING UI/UX FOR "ON-THE-FLY" SAMPLE CREATION
    * The Problem: The "Add Sample Inline" modal (in the Quick Checkout flow) was using an outdated UI without the on-the-fly manufacturer search/create functionality.
    * The Fix: We refactored `AddSampleInlineModal.tsx`, replacing its old form with the modern, consistent search component, unifying the user experience.